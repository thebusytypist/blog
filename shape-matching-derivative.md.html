<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156920447-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-156920447-1');
</script>
<meta charset="utf-8">

**Notes on Shape Matching**
    &#127968; [Home]("https://blog.linearconstraints.net") &#x2709; ounanding@gmail.com &#x1F4C5; Sun Oct 13 16:20:14 PDT 2019

$\newcommand{\V}[1]{\mathbf{#1}}$

I am (re)reading the shape matching paper from Matthias. Just write down something that are not obvious to me.

Derivative of shape matching objective
===================================
$$
\begin{align*}
\newcommand{\V}[1]{\mathbf{#1}}
F &= \sum_i w_i (\V{R} (\V{x}_i^0 - \V{t}_0) + \V{t} - \V{x}_i)^2
\end{align*}
$$

$$
\begin{align*}
\V{t}_0 &= \frac{\sum_i m_i \V{x}_i^0}{\sum_i m_i} &
\V{t} &= \frac{\sum_i m_i \V{x}_i}{\sum_i m_i} \\
\V{q}_i &= \V{x}_i^0 - \V{x}^0_{\text{cm}} &
\V{p}_i &= \V{x}_i - \V{x}_{\text{cm}}
\end{align*}
$$

$$
\begin{align*}
F &= \sum_i m_i (\V{A} \V{q}_i - \V{p}_i)^2 \\
&= \sum_i m_i (\V{A} \V{q}_i - \V{p}_i)^T (\V{A} \V{q}_i - \V{p}_i) \\
&= \sum_i m_i (
\V{q}_i^T \V{A}^T \V{A} \V{q}_i
- \V{q}_i^T \V{A}^T \V{p}_i
- \V{p}_i^T \V{A} \V{q}_i
+ \V{p}_i^T \V{p}_i)
\end{align*}
$$

$$
\begin{align*}
\frac{d (\V{x}^T\V{M}\V{y})}{d \V{M}}
&= (x_i M_{ij} y_j)_{,rs}
= x_i \delta_{ir} \delta_{js} y_j
= x_r y_s
= \V{x} \V{y}^T
\end{align*}
$$

$$
\begin{align*}
\frac{d (\V{x}^T\V{M}^T\V{y})}{d \V{M}}
&= (x_i M_{ji} y_j)_{,rs}
= x_i \delta_{jr} \delta_{is} y_j
= x_s y_r
= \V{y} \V{x}^T
\end{align*}
$$

$$
\begin{align*}
\frac{d (\V{x}^T\V{M}^T\V{M}\V{y})}{d \V{M}}
&= (x_i M_{ji} M_{jk} y_k)_{,rs}
= x_i \delta_{jr} \delta_{is} M_{jk} y_k
+ x_i M_{ji} \delta_{jr} \delta_{ks} y_k \\
&= x_s M_{rk} y_k + x_i M_{ri} y_s
= \V{M} \V{y} \V{x}^T + \V{M} \V{x} \V{y}^T
\end{align*}
$$

$$
\begin{align*}
\frac{d F}{d \V{A}}
&= \sum_i m_i (
2 \V{A} \V{q}_i \V{q}_i^T
- 2\V{p}_i \V{q}_i^T)
= \V{0} \\
\V{A} &=
(\sum_i m_i \V{p}_i \V{q}_i^T)(\sum_i m_i \V{q}_i \V{q}_i^T)^{-1}
\end{align*}
$$


<!-- Markdeep: --><style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace}</style><script src="markdeep.min.js" charset="utf-8"></script><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js" charset="utf-8"></script><script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>

